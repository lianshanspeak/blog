---
title: python_ansible自动化运维2
date: 2023-01-07 18:22:34
permalink: /pages/861bc8/
categories:
  - 编程
  - python
tags:
  - 
---
# 资产探测版块介绍

## 1.资产管理的内容

![image-20221225170948156](./image/image-20221225170948156.png)

扫描探测服务，主动收集信息

![image-20221225171148076](./image/image-20221225171148076.png)

![image-20221225171208280](./image/image-20221225171208280.png)

优势

![image-20221225171305473](./image/image-20221225171305473.png)

补充：虚拟机里面的虚拟机不在探测

![image-20221225171448491](./image/image-20221225171448491.png)

imoocc项目里面

自动化扫描是在main.py里实现的，可以定时任务执行这个文件

## 2.整体探测流程

![image-20221225174431220](./image/image-20221225174431220.png)



存活探测

trancroute

![image-20221225174535741](./image/image-20221225174535741.png)

![image-20221225174652947](./image/image-20221225174652947.png)

局域网内部扫描

![image-20221225174955115](./image/image-20221225174955115.png) 

![image-20221225175233259](./image/image-20221225175233259.png)

![image-20221225175354237](./image/image-20221225175354237.png)

-PE探测主机的存活状态,展示主机当前的一些服务，**确认服务是否存活**

![image-20221225175211444](./image/image-20221225175211444.png)

探测哪些常存在的

![image-20221225180131263](./image/image-20221225180131263.png)

## 3.python的nmap使用

安装

![image-20221225180611146](./image/image-20221225180611146.png)

在ipython中测试，等待返回结果

![image-20221225180730923](./image/image-20221225180730923.png)

展示IP列表

![image-20221225180843005](./image/image-20221225180843005.png)

判断是否是linux

![](./image/image-20221225180927822.png)

![image-20221225180955132](./image/image-20221225180955132.png)

![image-20221225181030220](./image/image-20221225181030220.png)

在ipython中测试

![image-20221225181231247](./image/image-20221225181231247.png)

![image-20221225181248920](./image/image-20221225181248920.png)

![image-20221225181334591](./image/image-20221225181334591.png)

![image-20221225181423327](./image/image-20221225181423327.png)

![image-20221225181438149](./image/image-20221225181438149.png)



密钥登录信息确认参数打开

![image-20221225181924978](./image/image-20221225181924978.png)

![image-20221225181916539](./image/image-20221225181916539.png)

![image-20221225182240438](./image/image-20221225182240438.png)

确保权限正确

![image-20221225182439666](./image/image-20221225182439666.png)

权限正确以后把rsa.pub拷贝到客户端/tmp/id_rsa

![image-20221225182402245](./image/image-20221225182402245.png)

## 4.python的ssh登录模块

![image-20221225185739767](./image/image-20221225185739767.png)

![image-20221225185755832](./image/image-20221225185755832.png)

pexpect安装

![image-20221225185959555](./image/image-20221225185959555.png)

测试

![image-20221225190119816](./image/image-20221225190119816.png)



![image-20221225190201601](./image/image-20221225190201601.png)

![image-20221225190554469](./image/image-20221225190554469.png)

![image-20221225190728982](./image/image-20221225190728982.png)

正则匹配

![image-20221225190756780](./image/image-20221225190756780.png)

![image-20221225190859742](./image/image-20221225190859742.png)

![image-20221225190929910](./image/image-20221225190929910.png)

![image-20221225191002119](./image/image-20221225191002119.png)

send会加上回车符，sendline不会

![image-20221225191241007](./image/image-20221225191241007.png)

相关脚本在script/4_4_9_ssh_login_password

![image-20221225191930666](./image/image-20221225191930666.png)

![image-20221225192307093](./image/image-20221225192307093.png)

![image-20221225192338288](./image/image-20221225192338288.png)



## 5.Paramiko模块

![image-20221226205441875](./image/image-20221226205441875.png)

![image-20221226205502225](./image/image-20221226205502225.png)

安装模块

pip install paramiko

在ipython中测试

import paramiko

hnow_hosts里面记录的是为了避免劫持

2：实例化对象

3：自动记录到know_hosts

![image-20221226210008633](./image/image-20221226210008633.png)

以上建立起了连接

13：加载密钥

![image-20221226210143516](./image/image-20221226210143516.png)

建立好了连接之后，怎么运行命令

![image-20221226210236678](./image/image-20221226210236678.png)

返回结果标准，错误

![image-20221226210333547](./image/image-20221226210333547.png)



# 登陆探测工程

## 1，机器资产信息获取

![image-20221226210527625](./image/image-20221226210527625.png)

获取操作系统信息

![image-20221226210600168](./image/image-20221226210600168.png)

![image-20221226210616875](./image/image-20221226210616875.png)



![image-20221226210804442](./image/image-20221226210804442.png)

![image-20221226210838008](./image/image-20221226210838008.png)

![image-20221226210845671](./image/image-20221226210845671.png)

![image-20221226210912449](./image/image-20221226210912449.png)

![image-20221226210940703](./image/image-20221226210940703.png)

不是以为这些开头的，获取网卡地址

![image-20221226211121870](./image/image-20221226211121870.png)

esxi信息

![image-20221226211200208](./image/image-20221226211200208.png)

同时获取，第一个执行失败执行第二个

![image-20221226211232346](./image/image-20221226211232346.png)

![image-20221226211327408](./image/image-20221226211327408.png)

![image-20221226211438448](./image/image-20221226211438448.png)

## 2.工程讲解

安装PyYAML

pip install PyYAML

![image-20221226212035980](./image/image-20221226212035980.png)

读取方式测试

![image-20221226212123070](./image/image-20221226212123070.png)



查看main文件进行扫描的，需要仔细分析这个文件

在4-19讲解的

![image-20221226212754545](./image/image-20221226212754545.png)

对数据加密解密测试

![image-20221226214857188](./image/image-20221226214857188.png)

![image-20221226214904540](./image/image-20221226214904540.png)

![image-20221226215014113](./image/image-20221226215014113.png)







main.py文件调试

和前面网段配置调整

![image-20221226221005668](./image/image-20221226221005668.png)

开始扫描

![image-20221226221058357](./image/image-20221226221058357.png)

扫描的相关信息

![image-20221226223135623](./image/image-20221226223135623.png)

看数据库里面的信息

![image-20221226223214358](./image/image-20221226223214358.png)

邮件的信息

![image-20221226223222504](./image/image-20221226223222504.png)

整体逻辑

![image-20221226223307072](./image/image-20221226223307072.png)









# 资产扫描进阶

![image-20230107172006065](./image/image-20230107172006065.png)

![image-20230107172038292](./image/image-20230107172038292.png)



![image-20230107172236698](./image/image-20230107172236698.png)

![image-20230107172328974](./image/image-20230107172328974.png)

## snmp网络设备

支持网络管理系统

![image-20230107172501500](./image/image-20230107172501500.png)

![image-20230107172543243](./image/image-20230107172543243.png)

安装之后配置服务信息

![image-20230107172719313](./image/image-20230107172719313.png)

![image-20230107172650787](./image/image-20230107172650787.png)



![image-20230107172825565](./image/image-20230107172825565.png)

客户端搭建

iso是标识，写了后面得就是指定返回信息，不指定就是所有

![image-20230107173033905](./image/image-20230107173033905.png)

python需要安装这个模块

![image-20230107173150959](./image/image-20230107173150959.png)

在ipython中测试

communitydata（‘snmpt’，‘public’,0），snmpt是索引值没有别的含义

![image-20230107173407914](./image/image-20230107173407914.png)

![image-20230107173459386](./image/image-20230107173459386.png)

返回结果，获取到对应的资产信息

![image-20230107173651065](./image/image-20230107173651065.png)

扫描网络信息代码讲解

![image-20230107173953993](./image/image-20230107173953993.png)



![image-20230107174021618](./image/image-20230107174021618.png)

![image-20230107174358859](./image/image-20230107174358859.png)

网络设备的扫描逻辑

![image-20230107174444784](./image/image-20230107174444784.png)

## 宿主机的归类

![image-20230107174527089](./image/image-20230107174527089.png)

![image-20230107174625424](./image/image-20230107174625424.png)

![image-20230107174747873](./image/image-20230107174747873.png)

![image-20230107174925996](./image/image-20230107174925996.png)



执行mian程序

![image-20230107175044687](./image/image-20230107175044687.png)

![image-20230107175057551](./image/image-20230107175057551.png)

![image-20230107175106453](./image/image-20230107175106453.png)

获取到了列表

## docker容器扫描

![image-20230107175301352](./image/image-20230107175301352.png)

![image-20230107175307542](./image/image-20230107175307542.png)

![image-20230107175356680](./image/image-20230107175356680.png)

 在ubantu上安装docker

![image-20230107175515539](./image/image-20230107175515539.png)

容器搭建成功之后，启动sshd,然后修改容器密码，exit退出

![image-20230107175656333](./image/image-20230107175656333.png)

docker ps 检查容器

模拟登录容器

![image-20230107175741753](./image/image-20230107175741753.png)

docker容器的宿主机确认

![image-20230107175835351](./image/image-20230107175835351.png)

如何切割获取想要的信息

![image-20230107180001771](./image/image-20230107180001771.png)

![image-20230107180110709](./image/image-20230107180110709.png)

![image-20230107180147334](./image/image-20230107180147334.png)

关联的两份儿代码

![image-20230107180308498](./image/image-20230107180308498.png)

执行main脚本

![image-20230107180424832](./image/image-20230107180424832.png)

到表里面查询相关信息

![image-20230107180452168](./image/image-20230107180452168.png)

![image-20230107180538080](./image/image-20230107180538080.png)

查找条件为114的

![image-20230107180633668](./image/image-20230107180633668.png)

## KVM扫描

![image-20230107181241731](./image/image-20230107181241731.png)

kvm搭建5-14

![image-20230107181309173](./image/image-20230107181309173.png)

![image-20230107181534799](./image/image-20230107181534799.png)

![image-20230107181619350](./image/image-20230107181619350.png)

![image-20230107181716552](./image/image-20230107181716552.png)

![image-20230107181751636](./image/image-20230107181751636.png)

![image-20230107181819094](./image/image-20230107181819094.png)

![image-20230107181902246](./image/image-20230107181902246.png)

![image-20230107181919103](./image/image-20230107181919103.png)



