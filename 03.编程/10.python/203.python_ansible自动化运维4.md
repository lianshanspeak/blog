---
title: python_ansible自动化运维4
date: 2023-01-09 23:28:32
permalink: /pages/ac6e7d/
categories:
  - 编程
  - python
tags:
  - 
---
# ansible自动化执行进阶和工程演练

![image-20230108173159422](./image/image-20230108173159422.png)

![image-20230108173331276](./image/image-20230108173331276.png)

![image-20230108173338389](./image/image-20230108173338389.png)

![image-20230108173454703](./image/image-20230108173454703.png)

在ipython下检查ansible是否安装成功

![image-20230108173556295](./image/image-20230108173556295.png)

![image-20230108173618478](./image/image-20230108173618478.png)



![image-20230108173628330](./image/image-20230108173628330.png)

![image-20230108173642744](./image/image-20230108173642744.png)

![image-20230108173736290](./image/image-20230108173736290.png)

![image-20230108173820614](./image/image-20230108173820614.png)

![image-20230108173826992](./image/image-20230108173826992.png)

先配置一个这样的配置文件

![image-20230108173946362](./image/image-20230108173946362.png)

主机资源配置

![image-20230108173959466](./image/image-20230108173959466.png)

![image-20230108174219850](./image/image-20230108174219850.png)

展示组名

![image-20230108174311053](./image/image-20230108174311053.png)

![image-20230108174359289](./image/image-20230108174359289.png)

![image-20230108174413952](./image/image-20230108174413952.png)

![image-20230108174445673](./image/image-20230108174445673.png)

添加主机

![image-20230108174527124](./image/image-20230108174527124.png)

![image-20230108174559566](./image/image-20230108174559566.png)

variableManger

![image-20230108174703930](./image/image-20230108174703930.png)

![image-20230108174721466](./image/image-20230108174721466.png)

![image-20230108174801808](./image/image-20230108174801808.png)

![image-20230108174819167](./image/image-20230108174819167.png)

获取详细的变量信息

![image-20230108174907573](./image/image-20230108174907573.png)

修改主机管理变量信息

![image-20230108174927807](./image/image-20230108174927807.png)

传入拓展变量

![image-20230108175031036](./image/image-20230108175031036.png)

## ad_hoc模式调用场景

![image-20230108175213516](./image/image-20230108175213516.png)

![image-20230108175232736](./image/image-20230108175232736.png)

option就是执行的选项

![image-20230108175314497](./image/image-20230108175314497.png)

![image-20230108175405494](./image/image-20230108175405494.png)

接收设置

![image-20230108181014876](./image/image-20230108181014876.png)

7-5讲解的

![image-20230108181107603](./image/image-20230108181107603.png)

![image-20230108181142293](./image/image-20230108181142293.png)

![image-20230108181151557](./image/image-20230108181151557.png)

![image-20230108181207843](./image/image-20230108181207843.png)

![image-20230108181223517](./image/image-20230108181223517.png)

![image-20230108181313798](./image/image-20230108181313798.png)



## playbook模式



![image-20230108181415336](./image/image-20230108181415336.png)

![image-20230108181420527](./image/image-20230108181420527.png)





![image-20230108181504020](./image/image-20230108181504020.png)

![image-20230108181552018](./image/image-20230108181552018.png)

![image-20230108181530047](./image/image-20230108181530047.png)



## callbackbase重写

![image-20230108181655369](./image/image-20230108181655369.png)

![image-20230108181718441](./image/image-20230108181718441.png)

![image-20230108181748334](./image/image-20230108181748334.png)

![image-20230108181808533](./image/image-20230108181808533.png)

![image-20230108181821805](./image/image-20230108181821805.png)

![image-20230108181854133](./image/image-20230108181854133.png)





新建类，继承，对类进行改写，自定义输出

对象改写

![image-20230108182047583](./image/image-20230108182047583.png)

脚本内容

![image-20230108182111295](./image/image-20230108182111295.png)



## 自动化接口设计

![image-20230108182138311](./image/image-20230108182138311.png)

![image-20230108182302571](./image/image-20230108182302571.png)

![image-20230108182413963](./image/image-20230108182413963-16731734543903.png)

![image-20230108182426342](./image/image-20230108182426342.png)



ansrunserver：初始化数据，命令执行，playbook方式执行

具体代码部分

![image-20230108194652457](./image/image-20230108194652457.png)



脚本运行这个文件，脚本调试得时候

![image-20230108195119457](./image/image-20230108195119457.png)

![image-20230108195214809](./image/image-20230108195214809.png)

这里注释需要打开

需要打印出来

![image-20230108195257247](./image/image-20230108195257247.png)

shell方式调试shell

![image-20230108195351496](./image/image-20230108195351496.png)



### view部分

![image-20230108195550562](./image/image-20230108195550562.png)

![image-20230108195632675](./image/image-20230108195632675.png)



![image-20230108195711873](./image/image-20230108195711873.png)

![image-20230108195757323](./image/image-20230108195757323.png)

![image-20230108195820275](./image/image-20230108195820275.png)

新增匹配奇数偶数



![image-20230108200502953](./image/image-20230108200502953.png)

之后到view里定义视图

这里给客户端返回一个黄色的文档

![image-20230108200611695](./image/image-20230108200611695.png)

访问

![image-20230108200628926](./image/image-20230108200628926.png)

![image-20230108200659859](./image/image-20230108200659859.png)



![image-20230108200900726](./image/image-20230108200900726.png)

![image-20230108200906096](./image/image-20230108200906096.png)

![image-20230108200937670](./image/image-20230108200937670.png)

![image-20230108200955851](./image/image-20230108200955851.png)

谷歌postman安装，没有前端的时候请求

![image-20230108201025432](./image/image-20230108201025432.png)

![image-20230108201207593](./image/image-20230108201207593.png)

### json数据处理

![image-20230108201237207](./image/image-20230108201237207.png)

![image-20230108201402007](./image/image-20230108201402007.png)





安装json包

![image-20230108201447063](./image/image-20230108201447063.png)

检测是否报错

![image-20230108201527095](./image/image-20230108201527095.png)

![image-20230108201549524](./image/image-20230108201549524.png)

![image-20230108201556825](./image/image-20230108201556825.png)

![image-20230108201640202](./image/image-20230108201640202.png)

![image-20230108201749560](./image/image-20230108201749560.png)

到views里面去看了

![image-20230108201929884](./image/image-20230108201929884.png)

adhoc_task任务处理

装饰器，封装另外一层功能

![image-20230108202025091](./image/image-20230108202025091.png)



![image-20230108202159880](./image/image-20230108202159880.png)

运行起来

![image-20230108203023636](./image/image-20230108203023636.png)

机器的唯一标识

![image-20230108203116450](./image/image-20230108203116450.png)

![image-20230108203133334](./image/image-20230108203133334.png)

![image-20230108203151887](./image/image-20230108203151887.png)

### 数据库事件记录

![image-20230108203345880](./image/image-20230108203345880.png)

![image-20230108203440630](./image/image-20230108203440630.png)







#### mango

![image-20230108203506299](./image/image-20230108203506299.png)

![image-20230108203511924](./image/image-20230108203511924.png)

![image-20230108203536083](./image/image-20230108203536083.png)

新建集合并插入数据

![image-20230108203624012](./image/image-20230108203624012.png)

要安装pymongo

插入数据

![image-20230108203753756](./image/image-20230108203753756.png)

![image-20230108203817861](./image/image-20230108203817861.png)

修改数据

![image-20230108203837203](./image/image-20230108203837203.png)

类似于json串的数据

![image-20230108203935244](./image/image-20230108203935244.png)

![image-20230108204003203](./image/image-20230108204003203.png)

![image-20230108204044358](./image/image-20230108204044358.png)

定义连接mango的方法

![image-20230108204337609](./image/image-20230108204337609.png)

#### 事件日志记录方式

![image-20230108204657212](./image/image-20230108204657212.png)

![image-20230108204704451](./image/image-20230108204704451.png)

![image-20230108204727131](./image/image-20230108204727131.png)

![image-20230108204735886](./image/image-20230108204735886.png)



#### redis实现任务锁

![image-20230108204826074](./image/image-20230108204826074.png)

![image-20230108204833394](./image/image-20230108204833394.png)

![image-20230108204906570](./image/image-20230108204906570.png)

![image-20230108204934809](./image/image-20230108204934809.png)

![image-20230108204945521](./image/image-20230108204945521.png)

![image-20230108204957472](./image/image-20230108204957472.png)

ipython中测试

传入值''a‘,1’,这里的第二步骤打错了

![image-20230108205223186](./image/image-20230108205223186.png)

![image-20230108205253969](./image/image-20230108205253969.png)



![image-20230108205325474](./image/image-20230108205325474.png)



![image-20230108205417004](./image/image-20230108205417004.png)

加锁解锁逻辑

![image-20230108205537565](./image/image-20230108205537565.png)

加锁测试

![image-20230108205709013](./image/image-20230108205709013.png)

![image-20230108205714909](./image/image-20230108205714909.png)

检查第二个任务

![image-20230108205647971](./image/image-20230108205647971.png)









# 全部章节总结

![image-20230108205815318](./image/image-20230108205815318.png)











