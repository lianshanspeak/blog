---
title: mysql技术内幕知识总结
date: 2022-11-21 09:06:33
permalink: /pages/c2e5f1/
categories:
  - 数据库
  - mysql
tags:
  - 
---
# 第一章 mysql体系结构和存储引擎



知识点1、理解数据库和实例

数据库：文件的集合，在mysql中可以是frm,MYD,MYI

实例：数据库实例在系统上的表现是一个进程。通过数据库实例，来对数据库进行操作

知识点2、读取文件配置顺序

在mysql中启动的时候没有配置文件时，会按照默认参数启动实例

/etc/my.cnf-->/etc/mysql/my.cnf-->/usr/local/mysql/etc/my.cnf-->/.my.cnf;以读取到最后一个参数配置文件为准



## mysql由哪几部分组成



- [ ] 连接池组件

- [ ] 管理服务和工作组件

- [ ] sql接口组件

- [ ] 查询分析器组件

- [ ] 优化器组件

- [ ] 缓冲器组件

- [ ] 插件式存储引擎

- [ ] 物理文件

    

## 存储引擎

可以根据不同的应用建立不同的存储引擎表

### innodb

特点：支持事务，主要面向OLTP（在线事务处理）,行锁设计，支持外键，默认读取不会产生锁

如何工作：

将数据放在一个逻辑的表空间（idb）中，通过MVCC来获得高并发性，实现sql的四种标准隔离，默认为**repeatable**，同时使用**next-keylocking**策略来避免**幻读**

提供以下常见功能

**插入缓存**

**二次写**

**自适应哈希索引**

**预读功能**

对于表中的数据存储采用聚集（clustered）的方式,按主键的顺序进行存放，没有设置主键，每行生成一个6字节的rowid作为主键

### Myisam

面向OLAP应用，不支持事务，缓冲池只缓存索引文件，不缓存数据文件。

如何工作：

由MYD（存放数据文件）和MYI（存放索引文件）组成。



### NDB存储引擎

**集群存储引擎**数据全部存放在内存中，，主键查找的速度快，通过添加NDB数据存储节点可以线性提高性能。

**注意**：NDB存储引擎的连接操作join，实是在数据库层完成的，不是在存储引擎层。复杂的连接操作会带来大的网络开销。导致查询速度慢。



### Memory存储引擎

将表中的数据存放在内存中，数据库重启或者崩溃，会导致数据表消失。常适用于临时数据的临时表默认使用**哈希索引**

存储引擎非常快，只支持表锁，并发性能差，不支持TEXT和BOLOB列类型。



### Archive存储引擎

只支持insert和select操作，支持索引，使用zlib对数据行进行压缩，压缩比1:10

试用场景:归档数据，日志信息，使用行锁来实现高并发插入。



### Maria存储引擎

取代MyISAM存储引擎，支持缓存数据和索引文件，支持MVCC，支持事务



## 连接数据库

连接操作是一个连接进程和mysql实例进行通信

常有的进程通信方式：管道，命名管道，命名名字，TCP/IP套接字

### TCP/IP连接方式

连接过程：通过TCP/IP连接到数据库时候，数据库会先检查权限视图，判断发起的IP是否允许连接，该视图为user表

```sql
use mysql
select host,user,password from user;
```



### 命名管道和共享内存

命名管道mysql必须启用--enable-named-pipe选项

共享内存连接方式必须启用--protocol-memory实现

### UNIX套接字

用户在配置文件中执行套接字路径：如 --socket=/tmp/mysql.sock

可以使用以下命令来查找套接字

```sql
show variables like 'socket';
```

套接字登录方式

```
mysql -u用户名 -S 套接字位置
```

